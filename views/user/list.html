<div class="layui-body">

    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
        <legend>用户列表</legend>
    </fieldset>

    <div class="demoTable">
        真实姓名：
        <div class="layui-inline">
            <input class="layui-input" name="realName" id="realName" autocomplete="off" placeholder="真实姓名">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>

        <button class="layui-btn layui-btn-normal" id="add">添加用户</button>

    </div>

    <table class="layui-hide" id="list" lay-filter="user_list"></table>

</div>


<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="modifypw">重置密码</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>


<div style="display:none" id="barEdit">
    <form class="layui-form" action="" method="post" >
        <div class="layui-form-item">
            <label class="layui-form-label">登录账号</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_username" readonly id="edit_username" lay-verify="required" autocomplete="off" placeholder="登录账号" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">工号</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_employee_number" id="edit_employee_number" lay-verify="required" autocomplete="off" placeholder="工号" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">真实姓名</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_real_name" id="edit_real_name" lay-verify="required" autocomplete="off" placeholder="真实姓名" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">显示姓名</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_display_name" id="edit_display_name" lay-verify="required" autocomplete="off" placeholder="真实姓名" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">姓</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_second_name" id="edit_second_name" lay-verify="required" autocomplete="off" placeholder="真实姓名" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">名</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_first_name" id="edit_first_name" lay-verify="required" autocomplete="off" placeholder="真实姓名" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">手机号码</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_phone" id="edit_phone" lay-verify="phone|required" autocomplete="off" placeholder="手机号码" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">电子邮箱</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_email" id="edit_email" lay-verify="required" autocomplete="off" placeholder="电子邮箱" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">公司</label>
            <div class="layui-input-block">
                <select name="edit_company" id="edit_company" lay-verify="required" autocomplete="off" placeholder="公司" class="layui-select">
                    <option value="">选择公司</option>
                    <option value="XXXXX有限公司">XXXXX有限公司</option>
                    <option value="XXXXX有限公司XXXXX分公司">XXXXX有限公司XXXXX分公司</option>
                    <option value="XXXXX有限公司XXXXX分公司">XXXXX有限公司XXXXX分公司</option>
                    <option value="XXXXX有限公司">XXXXX有限公司</option>
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">部门</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_department" id="edit_department" lay-verify="required" autocomplete="off" placeholder="部门" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">岗位</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_position" id="edit_position" lay-verify="required" autocomplete="off" placeholder="岗位" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">入职时间</label>
            <div class="layui-input-inline">
                <input type="text" name="edit_onboard_time" id="edit_onboard_time" lay-verify="required" autocomplete="off" placeholder="入职时间" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux">*</div>
        </div>

        <input type="hidden" id="edit_id" name="edit_id">

    </form>
</div>


<div style="display:none" id="barModifypw">
    <form class="layui-form" action="" method="post" >
        <div class="layui-form-item">
            <label class="layui-form-label">登录账号</label>
            <div class="layui-input-inline">
                <input type="text" name="modifypw_username" readonly id="modifypw_username" lay-verify="required" autocomplete="off" placeholder="登录账号" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item password">
            <label class="layui-form-label">设置密码</label>
            <div class="layui-input-inline">
                <input type="password" name="modifypw_password_new1" id="modifypw_password_new1" lay-verify="" autocomplete="off" placeholder="新密码" class="layui-input" value="">
            </div>
            <div class="layui-form-mid layui-word-aux"></div>
        </div>

        <div class="layui-form-item password">
            <label class="layui-form-label">重复密码</label>
            <div class="layui-input-inline">
                <input type="password" name="modifypw_password_new2" id="modifypw_password_new2" lay-verify="" autocomplete="off" placeholder="新密码" class="layui-input" value="">
            </div>
            <div class="layui-form-mid layui-word-aux"></div>
        </div>

        <input type="hidden" id="modifypw_id" name="modifypw_id">

    </form>
</div>


<div style="display:none" id="barAdd">
    <div class="layui-form-item">
        <label class="layui-form-label">登录账号</label>
        <div class="layui-input-inline">
            <input type="text" name="add_username" id="username" lay-verify="required" autocomplete="off" placeholder="登录账号" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">真实姓名</label>
        <div class="layui-input-inline">
            <input type="text" name="add_real_name" id="real_name" lay-verify="required" autocomplete="off" placeholder="真实姓名" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">显示姓名</label>
        <div class="layui-input-inline">
            <input type="text" name="add_display_name" id="display_name" lay-verify="required" autocomplete="off" placeholder="真实姓名" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">姓</label>
        <div class="layui-input-inline">
            <input type="text" name="add_secondname" id="secondname" lay-verify="required" autocomplete="off" placeholder="真实姓名" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">名</label>
        <div class="layui-input-inline">
            <input type="text" name="add_firstname" id="firstname" lay-verify="required" autocomplete="off" placeholder="真实姓名" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">手机号码</label>
        <div class="layui-input-inline">
            <input type="text" name="add_phone" id="phone" lay-verify="phone|required" autocomplete="off" placeholder="手机号码" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">电子邮箱</label>
        <div class="layui-input-inline">
            <input type="text" name="add_email" id="email" lay-verify="email" autocomplete="off" placeholder="电子邮箱" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">工号</label>
        <div class="layui-input-inline">
            <input type="text" name="add_employee_number" id="employee_number" lay-verify="employee_number" autocomplete="off" placeholder="工号" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">公司</label>
        <div class="layui-input-block">
            <select name="add_company" id="company" lay-verify="company" autocomplete="off" placeholder="公司" class="layui-select">
                <option value="XXXXX有限公司">XXXXX有限公司</option>
                <option value="XXXXX有限公司XXXXX分公司">XXXXX有限公司XXXXX分公司</option>
                <option value="XXXXX有限公司XXXXX分公司">XXXXX有限公司XXXXX分公司</option>
                <option value="XXXXX有限公司">XXXXX有限公司</option>
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">部门</label>
        <div class="layui-input-inline">
            <input type="text" name="add_department" id="department" lay-verify="company" autocomplete="off" placeholder="部门" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">岗位</label>
        <div class="layui-input-inline">
            <input type="text" name="add_position" id="email" lay-verify="position" autocomplete="off" placeholder="岗位" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">入职时间</label>
        <div class="layui-input-inline">
            <input type="text" name="add_onboard_time" id="email" lay-verify="onboard_time" autocomplete="off" placeholder="入职时间" class="layui-input">
        </div>
        <div class="layui-form-mid layui-word-aux">*</div>
    </div>
</div>


<script>
    layui.use(['table','form','element'], function(){
        var table = layui.table;
        var form = layui.form;
        var element = layui.element;

        table.render({
            elem: '#list'
            ,url:'/user/all'
            ,page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                //,curr: 5 //设定初始在第 5 页
                ,groups: 1 //只显示 1 个连续页码
                ,first: false //不显示首页
                ,last: false //不显示尾页
            }
            ,cols: [[
                {field:'id', title:'ID', width:80, fixed: 'left', unresize: true, sort: true}
                ,{field:'employee_number', title:'工号', width:80}
                ,{field:'username', title:'用户名', width:120}
                ,{field:'real_name', title:'真实姓名', width:120}
                ,{field:'display_name', title:'显示姓名', width:120}
                ,{field:'second_name', title:'姓', width:120}
                ,{field:'first_name', title:'名', width:120}
                ,{field:'email', title:'邮箱', width:180, templet: function(res) {
                        return '<em>' + res.email + '</em>'
                    }}
                ,{field:'phone', title:'手机号'}
                ,{field:'company', title:'公司'}
                ,{field:'department', title:'部门'}
                ,{field:'position', title:'岗位'}
                ,{field:'onboard_time', title:'入职时间'}
                ,{fixed:'right', title:'操作', align:'center', toolbar: '#barDemo', width:210}
            ]]
            ,id: 'listReload'
        });

        var $ = layui.$, active = {
            reload: function(){
                table.reload('listReload', {
                    where: {
                        realName: $('#realName').val(),
                    }
                });
            }
        };

        table.on('tool(user_list)', function(obj){
            var data = obj.data;
            if(obj.event === 'edit'){
                $('#edit_employee_number').val(data.employee_number);
                $('#edit_username').val(data.username);
                $('#edit_real_name').val(data.real_name);
                $('#edit_display_name').val(data.display_name);
                $('#edit_second_name').val(data.second_name);
                $('#edit_first_name').val(data.first_name);
                $('#edit_phone').val(data.phone);
                $('#edit_email').val(data.email);
                $('#edit_company').val(data.company);
                $('#edit_department').val(data.department);
                $('#edit_position').val(data.position);
                $('#edit_onboard_time').val(data.onboard_time);
                $('#edit_id').val(data.id);
                layer.open({
                    type: 1
                    ,btn: ['提交', '取消']
                    ,content: $('#barEdit')  //调到新增页面
                    ,btn1: function(){
                        // layer.msg(data.real_name);
                        var jsData = {
                            'id':$("input[name='edit_id']").val(),
                            'employee_number':$("input[name='edit_employee_number']").val(),
                            'real_name':$("input[name='edit_real_name']").val(),
                            'display_name':$("input[name='edit_display_name']").val(),
                            'second_name':$("input[name='edit_second_name']").val(),
                            'first_name':$("input[name='edit_first_name']").val(),
                            'phone':$("input[name='edit_phone']").val(),
                            'email':$("input[name='edit_email']").val(),
                            'company':$("select[name='edit_company']").val(),
                            'department':$("input[name='edit_department']").val(),
                            'position':$("input[name='edit_position']").val(),
                            'onboard_time':$("input[name='edit_onboard_time']").val()};
                        $.post('[[%urlfor "UserController.EditByAdmin"%]]', jsData, function (out) {
                            if (out.status == 0) {
                                layer.alert(out.message, {icon: 1},function(index){
                                    layer.close(index);
                                    window.location.reload();
                                });
                            } else {
                                layer.msg(out.message)
                            }
                        }, "json");
                    }
                });
            }
            else if(obj.event === 'modifypw'){
                $('#modifypw_username').val(data.username);
                $('#modifypw_id').val(data.id);
                layer.open({
                    type: 1
                    ,btn: ['提交', '取消']
                    ,content: $('#barModifypw')  //调到新增页面
                    ,btn1: function(){
                        // layer.msg(data.real_name);
                        var jsData = {
                            'id':$("input[name='modifypw_id']").val(),
                            'username':$("input[name='modifypw_username']").val(),
                            'password1':$("input[name='modifypw_password_new1']").val(),
                            'password2':$("input[name='modifypw_password_new2']").val()};
                        $.post('[[%urlfor "UserController.ModifyPwByAdmin"%]]', jsData, function (out) {
                            if (out.status == 0) {
                                layer.alert(out.message, {icon: 1},function(index){
                                    layer.close(index);
                                    window.location.reload();
                                });
                            } else {
                                layer.msg(out.message)
                            }
                        }, "json");
                    }
                });
            }
            else if(obj.event === 'del'){
                layer.open({
                    content: '确定要删除 【' + data.real_name + '】 吗？<br>(╬▔皿▔)凸'
                    ,btn: ['确定', '取消']
                    ,btn1: function(){
                        // layer.msg(data.real_name);
                        var jsData = {'id':data.id, 'username':data.username};
                        $.post('[[%urlfor "UserController.Del"%]]', jsData, function (out) {
                            if (out.status == 0) {
                                layer.alert(out.message, {icon: 1},function(index){
                                    layer.close(index);
                                    window.location.reload();
                                });
                            } else {
                                layer.msg(out.message)
                            }
                        }, "json");
                    }
                    ,btn2: function(){
                        layer.msg('取消');
                    }
                    ,cancel: function(){
                        layer.msg('X');
                    }
                });
            }
            else {
                layer.msg('操作不存在');
            }
        });

        $('#add').click(function(){
            layer.open({
                type: 1
                ,btn: ['提交', '取消']
                ,content: $('#barAdd')  //调到新增页面
                ,btn1: function(){
                    var jsData = {
                        'username':$("input[name='add_username']").val(),
                        'real_name':$("input[name='add_real_name']").val(),
                        'display_name':$("input[name='add_display_name']").val(),
                        'second_name':$("input[name='add_secondname']").val(),
                        'first_name':$("input[name='add_firstname']").val(),
                        'phone':$("input[name='add_phone']").val(),
                        'email':$("input[name='add_email']").val(),
                        'employee_number':$("input[name='add_employee_number']").val(),
                        'company':$("select[name='add_company']").val(),
                        'department':$("input[name='add_department']").val(),
                        'position':$("input[name='add_position']").val(),
                        'onboard_time':$("input[name='add_onboard_time']").val()};
                    $.post('[[%urlfor "UserController.Add"%]]', jsData, function (out) {
                        if (out.status == 0) {
                            layer.alert(out.message, {icon: 1},function(index){
                                layer.close(index);
                                window.location.reload();
                            });
                        } else {
                            layer.msg(out.message)
                        }
                    }, "json");
                }
            });
        });

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

    });
</script>




